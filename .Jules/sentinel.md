## 2025-02-18 - Resend Webhook Signature Verification Bypass
**Vulnerability:** The `_verify_svix_signature` function in `apps/api/app/services/webhooks/resend.py` had a "fail open" logic flaw where it would fall back to using the raw bytes of a `whsec_` prefixed secret if base64 decoding failed. This could allow an attacker to bypass signature verification if they could manipulate the stored secret or if it was misconfigured (e.g., cut off), or lead to key confusion.
**Learning:** Python's `base64` module is lenient and may successfully decode strings with invalid characters or incorrect padding if not strictly validated, but `binascii` raises errors for some cases. Security-critical code must explicitly handle decoding failures and fail securely (return `False` or raise) rather than falling back to insecure defaults.
**Prevention:** Always check the result of decoding operations in security contexts. If a specific format (like `whsec_` + base64) is expected, enforce it strictly and fail immediately if it doesn't match. Do not provide fallback paths that degrade security.
