# =============================================================================
# Environment
# =============================================================================
ENV=dev

# =============================================================================
# Database
# =============================================================================
DATABASE_URL=postgresql+psycopg://postgres:postgres@localhost:5432/crm
# DB pool tuning (defaults match SQLAlchemy)
# DB_POOL_SIZE=5
# DB_MAX_OVERFLOW=10
# DB_POOL_TIMEOUT=30
# DB_POOL_RECYCLE=-1
# DB_POOL_PRE_PING=true
# Fail readiness when migrations are pending (recommended in prod)
# DB_MIGRATION_CHECK=true
# Auto-apply Alembic migrations on startup (use with care)
# DB_AUTO_MIGRATE=false

# =============================================================================
# Session Token (JWT in HTTP-only cookie)
# =============================================================================
# Current signing key (min 32 chars in production)
JWT_SECRET=change-this-in-production-minimum-32-characters

# Previous key for rotation (set during rotation, clear after)
JWT_SECRET_PREVIOUS=

# Token expiry in hours
JWT_EXPIRES_HOURS=4

# Cookie SameSite policy: lax, strict, or none (none requires HTTPS)
COOKIE_SAMESITE=lax

# =============================================================================
# Google OAuth
# =============================================================================
# Create credentials at: https://console.cloud.google.com/apis/credentials
GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-client-secret
GOOGLE_REDIRECT_URI=http://localhost:8000/auth/google/callback

# =============================================================================
# Encryption Keys (REQUIRED)
# =============================================================================
# Used for encrypting OAuth tokens + AI keys at rest
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
FERNET_KEY=

# Used for encrypting PII fields (cases/intended parents)
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
DATA_ENCRYPTION_KEY=

# HMAC key for deterministic PII hashes (email/phone)
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
PII_HASH_KEY=

# Used for encrypting version snapshots (pipelines/templates/settings/etc)
# If empty, the app falls back to META_ENCRYPTION_KEY.
VERSION_ENCRYPTION_KEY=

# =============================================================================
# Per-User OAuth Integrations
# =============================================================================
ZOOM_CLIENT_ID=
ZOOM_CLIENT_SECRET=
ZOOM_REDIRECT_URI=http://localhost:8000/integrations/zoom/callback
ZOOM_WEBHOOK_SECRET=  # Webhook verification token from Zoom app settings (for meeting.started/ended events)

# Gmail integration OAuth (separate from Google Login OAuth)
GMAIL_REDIRECT_URI=http://localhost:8000/integrations/gmail/callback
# Gmail push notifications (users.watch -> Cloud Pub/Sub)
# Format: projects/{project-id}/topics/{topic-name}
GMAIL_PUSH_TOPIC=
# Optional comma-separated label IDs for watch filtering (example: INBOX,SENT)
GMAIL_PUSH_LABEL_IDS=
# Optional query token for /webhooks/google-gmail (configure same token on Pub/Sub push URL)
GMAIL_PUSH_WEBHOOK_TOKEN=
GOOGLE_CALENDAR_REDIRECT_URI=http://localhost:8000/integrations/google-calendar/callback
GCP_REDIRECT_URI=http://localhost:8000/integrations/gcp/callback

# =============================================================================
# Workload Identity Federation (OIDC for Vertex AI)
# =============================================================================
# Public issuer URL used by GCP WIF provider (defaults to API_BASE_URL in dev/test)
WIF_OIDC_ISSUER=
# PEM-encoded RSA private key used to sign WIF subject tokens
WIF_OIDC_PRIVATE_KEY=
# Optional key ID (kid) for JWKS rotation
WIF_OIDC_KEY_ID=

# =============================================================================
# Domain Restriction (optional)
# =============================================================================
# Comma-separated list of allowed email domains
# Leave empty to allow all domains
ALLOWED_EMAIL_DOMAINS=

# =============================================================================
# CORS
# =============================================================================
# Comma-separated allowed origins
CORS_ORIGINS=http://localhost:3000

# =============================================================================
# Frontend
# =============================================================================
# Used for safe post-login redirects
FRONTEND_URL=http://localhost:3000
# Unsubscribe token TTL (days)
UNSUBSCRIBE_TOKEN_TTL_DAYS=365

# Ops console (platform admin)
OPS_FRONTEND_URL=http://localhost:3000
# Cookie domain for cross-subdomain auth (e.g., .surrogacyforce.com)
COOKIE_DOMAIN=
# Platform base domain for slug-based subdomains (e.g., surrogacyforce.com)
# Tenant portals are at https://{slug}.{PLATFORM_BASE_DOMAIN}
PLATFORM_BASE_DOMAIN=surrogacyforce.com
# Comma-separated platform admin email allowlist
PLATFORM_ADMIN_EMAILS=
# Platform/system email sender (Resend) - used for system/platform emails (e.g., invites)
# Intentionally separate from RESEND_API_KEY so enabling platform email does not enable campaign sending.
PLATFORM_RESEND_API_KEY=
PLATFORM_RESEND_WEBHOOK_SECRET=
# Optional fallback From address. Recommended: set per-template `from_email` in Ops instead.
PLATFORM_EMAIL_FROM=
# HMAC secret for PII-safe audit logging (IP/user-agent hashing)
AUDIT_HMAC_SECRET=
# Support session configuration
SUPPORT_SESSION_TTL_MINUTES=60
SUPPORT_SESSION_ALLOW_READ_ONLY=false

# =============================================================================
# Dev-Only (required for /dev/* endpoints)
# =============================================================================
DEV_SECRET=local-dev-secret-change-me

# =============================================================================
# Meta Lead Ads Integration
# =============================================================================
# Create app at: https://developers.facebook.com/apps/
META_APP_ID=
META_APP_SECRET=

# Random token you create for webhook verification
META_VERIFY_TOKEN=your-random-verify-token

# Set to true only for local testing (uses mock data)
META_TEST_MODE=false

# Graph API version (update periodically)
META_API_VERSION=v24.0

# Encryption key for page access tokens (REQUIRED if using Meta integration)
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
META_ENCRYPTION_KEY=

# Webhook payload size limit in bytes
META_WEBHOOK_MAX_PAYLOAD_BYTES=100000

# =============================================================================
# Meta Ads Insights (Spend/Budget data)
# =============================================================================
# Ad Account ID from Meta Ads Manager (format: act_XXXXXX)
META_AD_ACCOUNT_ID=

# System user access token with ads_read permission
# Create a System User in Meta Business Manager with ads_read permission
META_SYSTEM_TOKEN=

# =============================================================================
# Meta Conversions API (CAPI) - Send lead quality signals back to Meta
# =============================================================================
# When a Meta lead becomes "qualified", we notify Meta to optimize ad targeting
# This improves your Return on Ad Spend (ROAS) over time

# Dataset/Pixel ID from Meta Events Manager
META_PIXEL_ID=

# Set to true to enable sending conversion events to Meta
META_CAPI_ENABLED=false

# Optional: System user access token for CAPI (if not set, falls back to page token)
# Recommended: Create a System User in Meta Business Manager for dedicated CAPI access
META_CAPI_ACCESS_TOKEN=

# =============================================================================
# INTERNAL ENDPOINTS (Scheduled/Cron jobs)
# =============================================================================
# Secret for authenticating calls to /internal/scheduled/* endpoints
# Generate with: openssl rand -hex 32
INTERNAL_SECRET=

# =============================================================================
# ERROR TRACKING (Optional)
# =============================================================================
# Sentry DSN for error tracking in production
# Get from: https://sentry.io -> Project Settings -> Client Keys (DSN)
# Only initializes when ENV != "dev"
SENTRY_DSN=

# =============================================================================
# GCP MONITORING (Cloud Logging + Error Reporting)
# =============================================================================
# Set to 0 to disable GCP monitoring
GCP_MONITORING_ENABLED=1
# Optional override (Cloud Run sets GOOGLE_CLOUD_PROJECT automatically)
GCP_PROJECT_ID=
# Service name shown in Error Reporting
GCP_SERVICE_NAME=crm-api
# 0.0 - 1.0 sampling rate for error reporting
GCP_ERROR_REPORTING_SAMPLE_RATE=1.0

# =============================================================================
# RATE LIMITING
# =============================================================================
# Requests per minute per IP (defaults shown)
# RATE_LIMIT_AUTH=5       # Login attempts
# RATE_LIMIT_WEBHOOK=100  # Meta webhooks
# RATE_LIMIT_API=60       # General API
# RATE_LIMIT_SEARCH=30    # Global search
# RATE_LIMIT_PUBLIC_FORMS=10  # Public form submissions
# RATE_LIMIT_FAIL_OPEN=true  # Use in-memory limiter if Redis is unavailable (set false to fail closed)

# =============================================================================
# ANALYTICS CACHE
# =============================================================================
# Cache TTL for analytics snapshots (seconds)
ANALYTICS_CACHE_TTL_SECONDS=300

# =============================================================================
# OBSERVABILITY (OpenTelemetry)
# =============================================================================
# Enable OpenTelemetry tracing when OTLP endpoint is configured
OTEL_ENABLED=false
OTEL_SERVICE_NAME=crm-api
OTEL_EXPORTER_OTLP_ENDPOINT=
OTEL_EXPORTER_OTLP_HEADERS=
OTEL_SAMPLE_RATE=0.1

# =============================================================================
# SLO DEFAULTS (Core Workflows)
# =============================================================================
SLO_SUCCESS_RATE=0.99
SLO_AVG_LATENCY_MS=500
SLO_WINDOW_MINUTES=60

# =============================================================================
# COMPLIANCE / RETENTION
# =============================================================================
# Default retention window for purgeable entities (days)
DEFAULT_RETENTION_DAYS=2190

# =============================================================================
# EMAIL PROVIDER (Resend)
# =============================================================================
# Get your API key from: https://resend.com/api-keys
# Required for sending emails (templates, notifications, etc.)
# Without this key, email jobs will run in "dry run" mode (logged but not sent)
RESEND_API_KEY=

# =============================================================================
# REDIS (Optional)
# =============================================================================
# Redis URL for distributed rate limiting across multiple workers
# If not set, falls back to in-memory rate limiting (single worker only)
# Format: redis://:<password>@localhost:6379/0
REDIS_URL=
# Require Redis for readiness (fail closed if unavailable)
# REDIS_REQUIRED=false
# Optional connection pool cap
# REDIS_MAX_CONNECTIONS=20
# Seconds to keep in-memory rate limit after Redis errors
# RATE_LIMIT_REDIS_FALLBACK_SECONDS=30

# =============================================================================
# FILE UPLOADS / MALWARE SCANNING
# =============================================================================
# Enable ClamAV scanning for file uploads
ATTACHMENT_SCAN_ENABLED=true
# Optional: share ClamAV signatures via S3-compatible storage
CLAMAV_SIGNATURES_BUCKET=
CLAMAV_SIGNATURES_PREFIX=clamav
CLAMAV_SIGNATURES_MAX_AGE_HOURS=168
# If true, only download signatures from storage; never run freshclam in the worker
CLAMAV_SIGNATURES_DOWNLOAD_ONLY=true

# =============================================================================
# WORKER / CAMPAIGNS
# =============================================================================
# Restrict a worker to specific job types (comma-separated)
# Include form_submission_file_scan to scan form uploads
WORKER_JOB_TYPES=
# Enable fallback Google Calendar/Tasks sync scheduling from the worker loop.
# Keeps sync running if /internal/scheduled/google-calendar-sync cron is not configured.
GOOGLE_CALENDAR_SYNC_FALLBACK_ENABLED=true
# Interval (seconds) for fallback scheduling checks.
GOOGLE_CALENDAR_SYNC_FALLBACK_INTERVAL_SECONDS=300
# Enable fallback Gmail mailbox sync scheduling from the worker loop.
# Keeps ticketing inbox ingestion running when /internal/scheduled/gmail-sync cron is not configured.
GMAIL_SYNC_FALLBACK_ENABLED=true
# Interval (seconds) for Gmail fallback scheduling checks.
GMAIL_SYNC_FALLBACK_INTERVAL_SECONDS=60
# Batch size for campaign sends
CAMPAIGN_SEND_BATCH_SIZE=200
# Instance id for websocket backplane (optional)
WEBSOCKET_INSTANCE_ID=
